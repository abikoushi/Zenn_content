---
title: "é›¢æ•£åŒ–ã•ã‚ŒãŸæ‹¡æ•£æ–¹ç¨‹å¼ã®çŠ¶æ…‹ç©ºé–“ãƒ¢ãƒ‡ãƒ«"
emoji: "ğŸ’œ"
type: "tech"
topics:
  - "r"
  - "åå¾®åˆ†æ–¹ç¨‹å¼"
  - "çŠ¶æ…‹ç©ºé–“ãƒ¢ãƒ‡ãƒ«"
  - "æ‹¡æ•£æ–¹ç¨‹å¼"
published: true
published_at: "2024-03-22 21:23"
---

## æ‹¡æ•£æ–¹ç¨‹å¼

æ¬¡ã®åå¾®åˆ†æ–¹ç¨‹å¼ã‚’ä¸€æ¬¡å…ƒã®æ‹¡æ•£æ–¹ç¨‹å¼ã¨å‘¼ã¶ï¼š

$$
\frac{\partial}{\partial t} u(t,x) = a \frac{\partial}{\partial x^2} u(t,x)
$$

ã“ã“ã§ $u(x, t)$ ã¯ä½ç½® $x$, æ™‚ç‚¹ $t$ ã«ãŠã‘ã‚‹è€ƒãˆãŸã„å¯¾è±¡ã®ç‰©ã®æ¿ƒåº¦ã¨ã—ãŸ.
$a$ ã¯æ‹¡æ•£ä¿‚æ•°ã¨å‘¼ã°ã‚Œã‚‹å®šæ•°ã§ $a > 0$ ã§ã‚ã‚‹.

æ‹¡æ•£æ–¹ç¨‹å¼ã‚’é›¢æ•£åŒ–ã—ã¦ $u_{tx}$ ($t=0,1, \ldots ,m$, $x=1, \ldots ,n$) ã«ã¤ã„ã¦æ¬¡ã®å·®åˆ†æ–¹ç¨‹å¼ã‚’è€ƒãˆã‚‹.

$$
\begin{aligned}
u_{t+1,x}-u_{t,x} &= a ( u_{t,x+1}-u_{t,x} - (u_{t,x}-u_{t,x-1})  )\\
&=a ( u_{t,x+1}-2u_{t,x}+u_{t,x-1})  )\tag{1}
\end{aligned}
$$

æ·»å­—ãŒ$t$ã®å¤‰æ•°ã‚’å…¨éƒ¨å³è¾ºã«, $t+1$ã®å¤‰æ•°ãŒå…¨éƒ¨å·¦è¾ºã«ãã‚‹ã‚ˆã†ã«æ›¸ãæ›ãˆã‚‹ã¨æ™‚ç‚¹$t$ã®çŠ¶æ…‹ï¼ˆç¾åœ¨ï¼‰ã‹ã‚‰æ¬¡ã®$t+1$ã§ã®çŠ¶æ…‹ï¼ˆæœªæ¥ï¼‰ãŒã‚ã‹ã£ã¦ä¾¿åˆ©ã§ã‚ã‚‹ï¼š

$$
\begin{aligned}
u_{t+1,x} &= u_{t,x} + a ( u_{t,x+1}-2u_{t,x}+u_{t,x-1})  )\\
 &= (1-2a)u_{t,x} + a u_{t,x+1} + au{t,x-1}
\end{aligned}
$$

$u_t=(u_{t,1}, \ldots , u_{t,n})'$ ã¨ã¾ã¨ã‚ã‚‹ã¨, æ¬¡ã®ã‚ˆã†ã«è¡Œåˆ—ã‚’ä½¿ã£ã¦æ›¸ãã“ã¨ã‚‚ã§ãã‚‹ï¼š

$$
u_{t+1} = \begin{pmatrix}
\ddots& & & &\\ 
& 1-2a & 0 & 0& \\
&a & 1-2a & 0&\\
&0 & a & 1-2a & \\
& & & & \ddots\\ 
\end{pmatrix} u_t. \tag{1'}
$$

ã¨ã“ã‚ã§, (1) ã§ã¯æ™‚é–“ã«ã¤ã„ã¦ã®å·®åˆ†ã¨ã—ã¦ $u_{t+1,x}-u_{t,x}$ ã‚’è€ƒãˆãŸ.

æ™‚é–“ã«ã¤ã„ã¦ã®å·®åˆ†ã¨ã—ã¦ $u_{t,x}-u_{t-1,x}$ ã‚’è€ƒãˆã‚‹ã“ã¨ã«ã™ã‚‹ã¨,

$$
u_{t,x}-u_{t-1,x} = a ( u_{t,x+1}-2u_{t,x}+u_{t,x-1}) )ã€€\tag{2}
$$

ã‚ˆã‚Š

$$
\begin{aligned}
u_{t-1,x} &= u_{t,x} - a ( u_{t,x+1}-2u_{t,x}+u_{t,x-1})  )\\
 &= (1+2a)u_{t,x} - a u_{t,x+1} - au{t,x-1} 
\end{aligned}
$$

ã¨ã„ã†æ–¹ç¨‹å¼ã‚’å°ãã“ã¨ã‚‚ã§ãã‚‹.

(1') ã¨åŒæ§˜ã«è¡Œåˆ—ã‚’ä½¿ã£ã¦

$$
u_{t-1} = \begin{pmatrix}
\ddots  &      &      &    & \\ 
        & 1+2a &   0  & 0  & \\
        & -a   & 1+2a & 0  & \\
        &   0  & -a   & 1+2a & \\
        &      &      &      & \ddots\\ 
\end{pmatrix} u_t
$$

æ›¸ãã“ã¨ãŒã§ãã‚‹. 

æ·»å­—ãŒ$t$ã®å¤‰æ•°ã‚’å…¨éƒ¨å³è¾ºã«, $t+1$ã®å¤‰æ•°ãŒå…¨éƒ¨å·¦è¾ºã«ãã‚‹ã‚ˆã†ã«æ›¸ãæ›ãˆã‚‹ã¨

$$
u_{t} =  \begin{pmatrix}
\ddots  &      &      &    & \\ 
        & 1+2a &   0  & 0  & \\
        & -a   & 1+2a & 0  & \\
        &   0  & -a   & 1+2a & \\
        &      &      &      & \ddots\\ 
\end{pmatrix} ^{-1} u_{t}. \tag{2'}
$$

ãŒå¾—ã‚‰ã‚Œã‚‹.

ã•ã¦, ä»¥ä¸Šã§ã¯å®Ÿã¯è€ƒãˆã¦ã„ã‚‹ç©ºé–“ã®ç«¯ã£ã“ï¼ˆ$u_{t,1}$ ã¨ $u_{t,n}$ï¼‰ã§2éšå·®åˆ†ãŒå®šç¾©ã•ã‚Œã¦ã„ãªã‹ã£ãŸ.

ç«¯ã£ã“ã§ã¯ç‰©ã®å‡ºå…¥ã‚ŠãŒãªã„ã¨ã—ã¦

$$
u_{t,1} - u_{t,0} = 0
$$

$$
u_{t,n+1} - u_{t,n} = 0
$$

ã¨ã™ã‚‹ï¼ˆåå¾®åˆ†æ–¹ç¨‹å¼ã§ã„ã†å¢ƒç•Œæ¡ä»¶ã«å¯¾å¿œã™ã‚‹ï¼‰ã¨(1)ã¯æ¬¡ã®ã‚ˆã†ã«ãªã‚‹ï¼š

$$
\begin{aligned}
u_{t+1,1}-u_{t,1} &= a (u_{t,2}-u_{t,1})\\
u_{t+1,1} &= (1-a)u_{t,1}+a u_{t,2}
\end{aligned}
$$

$u_{t+1,n}$ ã«ã¤ã„ã¦ã‚‚åŒæ§˜ã®è¨ˆç®—ã‚’ã—ã¦ã¾ã¨ã‚ã‚‹ã¨æ¬¡ã‚’å¾—ã‚‹ï¼š

$$
u_{t+1} = Au_t \tag{1''}
$$

è¡Œåˆ— $A$ ã¯

$$
\begin{aligned}
A=\begin{pmatrix}
1-a & a & 0 & 0 & \cdots & 0 & 0 & 0\\
a & 1-2a & a & 0 & \cdots &0 & 0 & 0\\
0 & a & 1-2a & a & \cdots &0 & 0 & 0\\
\vdots &\vdots &\vdots &\vdots & \ddots & \vdots &\vdots &\vdots\\
0 & 0 & 0 & 0 & \cdots & 1-2a & a & 0\\
0 & 0 & 0 & 0 & \cdots & a & 1-2a & a\\
0 & 0 & 0 & 0 & \cdots & 0 & a & 1-a \\
\end{pmatrix}.
\end{aligned}
$$

ã¨ã—ãŸ.

(2')ã¯æ¬¡ã®ã‚ˆã†ã«æ›¸ã‘ã‚‹ï¼š

$$
u_{t+1} = A^{-1}u_t \tag{2''}
$$

ã“ã“ã§è¡Œåˆ— $A$ ã¯

$$
\begin{aligned}
A=\begin{pmatrix}
1+a & -a & 0 & 0 & \cdots & 0 & 0 & 0\\
-a & 1+2a & -a & 0 & \cdots &0 & 0 & 0\\
0 & -a & 1+2a & -a & \cdots &0 & 0 & 0\\
\vdots &\vdots &\vdots &\vdots & \ddots & \vdots &\vdots &\vdots\\
0 & 0 & 0 & 0 & \cdots & 1+2a & -a & 0\\
0 & 0 & 0 & 0 & \cdots & -a & 1+2a & -a\\
0 & 0 & 0 & 0 & \cdots & 0 & -a & 1+a \\
\end{pmatrix},
\end{aligned}
$$

ã¨ã—ãŸ.

(1'')ã®ã‚„ã‚Šæ–¹ã‚’ï¼ˆæ‹¡æ•£æ–¹ç¨‹å¼ã®æ•°å€¤è§£æ³•ã§æ›´æ–°å¼ãŒé™½ã«æ›¸ã‘ã‚‹ã®ã§ï¼‰é™½è§£æ³•, (2'')ã®ã‚„ã‚Šæ–¹ã‚’é™°è§£æ³•ã¿ãŸã„ã«å‘¼ã¶ã“ã¨ã‚‚ã‚ã‚‹. ä»¥é™, ã“ã®è¨˜äº‹ã§ã‚‚ã“ã®å‘¼ã³æ–¹ã‚’ä½¿ã†.


## Rã«ã‚ˆã‚‹è¨ˆç®—ä¾‹ï¼ˆãƒã‚¤ã‚ºãªã—ï¼‰

åˆæœŸæ¡ä»¶ã¯æ¬¡ã®ã‚ˆã†ã«ä¸ãˆãŸï¼š

```r
u_ini = numeric(20)
u_ini[c(3:5,8:10,15:16)] = 1
```

é™½è§£æ³•ã¯ã»ã¼(1'')ã®å¼é€šã‚Šã§, è¡Œåˆ— `A` ã‚’æ¬¡ã®ã‚ˆã†ã«ä½œã‚Š, `for` æ–‡ã§ç¹°ã‚Šè¿”ã—ã‹ã‘ã¦ã„ã.

```r
#r ãŒæ‹¡æ•£ä¿‚æ•°
A <- diag(1-2*r,n)
A[cbind(2:n,1:(n-1))] <- r
A[cbind(1:(n-1),2:n)] <- r
A[1,1] = 1-r
A[n,n] = 1-r   
```

é™°è§£æ³•ã¯(2'')ã®å¼é€šã‚Šæ„šç›´ã«å®Ÿè£…ã™ã‚‹ã¨é€†è¡Œåˆ—ãŒå‡ºã¦ãã¦ã—ã¾ã†ãŒ, ä»Šå›ã¯ãã®ã¾ã¾æ„šç›´ã«`solve`é–¢æ•°ã‚’ä½¿ã£ã¦å®Ÿè£…ã—ãŸ.

```r
#r ãŒæ‹¡æ•£ä¿‚æ•°
A <- diag(1+2*r,n)
A[cbind(2:n,1:(n-1))] <- -r
A[cbind(1:(n-1),2:n)] <- -r
A[1,1] = 1+r
A[n,n] = 1+r
A <- solve(A)
```

æ‹¡æ•£ä¿‚æ•° $a=0.2$ ã¨ã—ã¦é™½è§£æ³•ã«ã‚ˆã‚‹çµæœï¼š

![](https://storage.googleapis.com/zenn-user-upload/8a55dbc2c276-20240322.png)

ã“ã®å›³ï¼ˆ3ã¤ï¼‰ã¯å…¨éƒ¨åŒã˜å¯¾è±¡ $u_{x,t}$ ã‚’ãƒ—ãƒ­ãƒƒãƒˆã—ã¦ã„ã‚‹. `time` $t$, `x` ãŒ $x$, `density` ãŒ $u_{x,t}$.

ï¼ˆè‡ªåˆ†ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã¨ã—ã¦ã¯ç´°é•·ã„æ°´æ§½ã«ä½•ã‹æ‰€ã‹åŒæ™‚ã«ã‚¤ãƒ³ã‚¯ã‚’å…¥ã‚Œã¦åºƒãŒã£ã¦è¡Œãæ§˜å­ã‚’è¦‹ã¦ã‚‹ã¿ãŸã„ãªæ„Ÿã˜ã§ã™.ï¼‰

æ‹¡æ•£ä¿‚æ•° $a=0.2$ ã¨ã—ã¦é™°è§£æ³•ã«ã‚ˆã‚‹çµæœï¼š

![](https://storage.googleapis.com/zenn-user-upload/bc14378877e5-20240322.png)

ã±ã£ã¨è¦‹ã§ã¯åŒºåˆ¥ãŒã¤ã‹ãªã„ãã‚‰ã„ä¼¼ãŸã‚ˆã†ãªå€¤ãŒå¾—ã‚‰ã‚Œã¦ã„ã‚‹.

ã®ã§, æ¯”è¼ƒã®ãŸã‚ $x$ ã”ã¨ã«åŒã˜ãƒ‘ãƒãƒ«ã«ãƒ—ãƒ­ãƒƒãƒˆã—ã¦ã¿ã‚‹ï¼š

![](https://storage.googleapis.com/zenn-user-upload/9557e76d7b14-20240322.png)

æ¬¡ã«, æ‹¡æ•£ä¿‚æ•° $a=0.5$ ã¨ã—ã¦é™½è§£æ³•ã«ã‚ˆã‚‹çµæœï¼š

![](https://storage.googleapis.com/zenn-user-upload/0fe2d1772e21-20240322.png)

æ¿ƒåº¦ãŒä¸ŠãŒã£ãŸã‚Šä¸‹ãŒã£ãŸã‚Šã—ã¦ã„ã¦æ‹¡æ•£ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã—ã¦ã¯ä¸é©å½“ã§ã‚ã‚‹.

æ‹¡æ•£ä¿‚æ•° $a=0.5$ ã¨ã—ã¦é™°è§£æ³•ã«ã‚ˆã‚‹çµæœï¼š

![](https://storage.googleapis.com/zenn-user-upload/b5c8a4c875c4-20240322.png)

ã“ã¡ã‚‰ã¯ã†ã¾ãã„ã£ã¦ãã†.

é™°è§£æ³•ã®ã»ã†ãŒå®‰å®šã—ã¦è¨ˆç®—ã§ããã†ãªã®ã§ä»¥é™ã¯é™°è§£æ³•ã‚’ä½¿ã†ã“ã¨ã«ã™ã‚‹.

ãŸã¶ã‚“ã“ã‚Œã‚‰ã®è§£æ³•ãŒä½¿ãˆã‚‹æ¡ä»¶ã¨ã‹è§£ã®ç²¾åº¦ã«ã¤ã„ã¦, æœ¬å½“ã¯ã‚ã‚‹ç¨‹åº¦è§£æçš„ã«æ±‚ã‚ã‚‰ã‚Œã‚‹ã‚“ã˜ã‚ƒãªã„ã‹ã¨æ€ã†. ãŒ, ã‚ˆãçŸ¥ã‚‰ãªã„ã®ã§ã“ã‚Œèª­ã‚€ã¨ã„ã„ã‚ˆãƒ¼ã¿ãŸã„ãªã®ãŒã‚ã£ãŸã‚‰æ•™ãˆã¦ãã ã•ã„.

## çŠ¶æ…‹ç©ºé–“ãƒ¢ãƒ‡ãƒ«

çŠ¶æ…‹ç©ºé–“ãƒ¢ãƒ‡ãƒ«ã¨ã¯æ¬¡ã®ã‚ˆã†ãªç¢ºç‡åˆ†å¸ƒã®çµ„ã§è¡¨ã•ã‚Œã‚‹ãƒ¢ãƒ‡ãƒ«ã®ã“ã¨ã‚’æŒ‡ã™ï¼š

$$
\begin{aligned}
y_t &\sim f(y_t|x_t) \\
x_t &\sim f(x_t|x_{t-1}). 
\end{aligned}
$$

ä»Šå›ã¯ãªã‹ã§ã‚‚æ¬¡ã®å½¢ã§æ›¸ã‘ã‚‹æ­£è¦ç·šå½¢ã®çŠ¶æ…‹ç©ºé–“ãƒ¢ãƒ‡ãƒ«ã«ã¤ã„ã¦è€ƒãˆã‚‹ï¼š

$$
\begin{aligned}
y_t &= Fx_t + \varepsilon_t, \quad \varepsilon_t \sim \mathcal{N}(\varepsilon_t|0, V)\\
x_t &= Gx_{t-1} + \eta_t, \quad \eta_t \sim \mathcal{N}(\eta_t|0, W). 
\end{aligned}
$$

$\varepsilon_t \sim \mathcal{N}(\varepsilon_t \sim |0, V)$ ã¯ã€Œç¢ºç‡å¤‰æ•°$\varepsilon_t$ ãŒå¹³å‡0, åˆ†æ•£$V$ã®æ­£è¦åˆ†å¸ƒã«å¾“ã†ã€ã‚’æ„å‘³ã™ã‚‹.

$x_t = Gx_{t-1} + \eta_t$ ã‚’ $x_t \approx Gx_{t-1}$ ã®ã‚ˆã†ã«æ›¸ãç›´ã—ã¦ã¿ã‚‹ã¨, (1'')ã‚„(2''ï¼‰ã¨ã®é¡ä¼¼ãŒã‚ã‹ã‚Šã‚„ã™ããªã‚‹ã®ã§ã¯ãªã„ã‹ã¨æ€ã†.


## Rã«ã‚ˆã‚‹è¨ˆç®—ä¾‹ï¼ˆãƒã‚¤ã‚ºã‚ã‚Šï¼‰

çŠ¶æ…‹ $x_t$ ã«ã¤ã„ã¦ã¯ã‚«ãƒ«ãƒãƒ³ãƒ•ã‚£ãƒ«ã‚¿ã§æ¨å®šã—, å›ºå®šãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼ˆåˆ†æ•£ã¨æ‹¡æ•£ä¿‚æ•°ï¼‰ã«ã¤ã„ã¦ã¯æœ€å°¤æ³•ã§æ±‚ã‚ã‚‹ã“ã¨ã«ã™ã‚‹. dlmãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½¿ã†.

ã‚«ãƒ«ãƒãƒ³ãƒ•ã‚£ãƒ«ã‚¿è‡ªä½“ã«ã¤ã„ã¦ã¯åˆ¥ã®æ–‡çŒ®ã‚’å‚ç…§ã—ã¦ã»ã—ã„ãŒ, ä½•ã‚’èª­ã‚€ã®ãŒã„ã„ã‚“ã ã‚ã†.

ã¨ã‚Šã‚ãˆãš

[é‡æ‘ä¿Šä¸€ã€ã‚«ãƒ«ãƒãƒ³ãƒ•ã‚£ãƒ«ã‚¿â€•Rã‚’ä½¿ã£ãŸæ™‚ç³»åˆ—äºˆæ¸¬ã¨çŠ¶æ…‹ç©ºé–“ãƒ¢ãƒ‡ãƒ«â€•ã€(å…±ç«‹å‡ºç‰ˆ)](https://www.amazon.co.jp/%E3%82%AB%E3%83%AB%E3%83%9E%E3%83%B3%E3%83%95%E3%82%A3%E3%83%AB%E3%82%BF-%E2%80%95R%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%9F%E6%99%82%E7%B3%BB%E5%88%97%E4%BA%88%E6%B8%AC%E3%81%A8%E7%8A%B6%E6%85%8B%E7%A9%BA%E9%96%93%E3%83%A2%E3%83%87%E3%83%AB%E2%80%95-%E7%B5%B1%E8%A8%88%E5%AD%A6One-Point-2/dp/4320112539?__mk_ja_JP=%E3%82%AB%E3%82%BF%E3%82%AB%E3%83%8A&crid=3BU6RWSJABQCW&dib=eyJ2IjoiMSJ9.2p9BwgqQzOde3nr2IsZVOWzAUzQk8R5PdQIKGdZCTYz7CJ0EglgyYPw_qZ0xaJTc0n4Br73UBF5JbXy4e9rvmPr1IV2fusWyrXQ8VRC97Fg03UolPQjAqBknaPq5oDiazuHjL0GNxsrGvmqjh3ZKz-O7IcrejEUHSueRp4QS_5tVzy5wAmxbuIIlTYRm8nbNup5RAoN7Sr-GGOKUgtl7xGDs_N3X7pVuExbohCxTCIz6UnlNlVQSN5IuOk4SncmjD6Fl9kRRCo7xjYW_L3DN2tpqpYpDsQ2UR58gD4F9Iyg.iNNt6qKGeJxXC68GeJQAl_3Y5M0klk5v6NREzgk0zL4&dib_tag=se&keywords=%E7%8A%B6%E6%85%8B%E7%A9%BA%E9%96%93%E3%83%A2%E3%83%87%E3%83%AB&qid=1711280513&sprefix=%E3%81%98%E3%82%87%E3%81%86%E3%81%9F%E3%81%84%2Caps%2C258&sr=8-2&linkCode=ll1&tag=abikoushi-22&linkId=d44f27abbc2babaf43d873f2baf211da&language=ja_JP&ref_=as_li_ss_tl)

ã®ã‚¢ãƒã‚¾ãƒ³ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆãƒªãƒ³ã‚¯ã‚’è²¼ã£ã¦ãŠãã¾ã™ï¼ˆãŸã ã—ã“ã®æœ¬ã¯dlmãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¯ä½¿ã£ã¦ãªã„ï¼‰.

é›¢æ•£åŒ–ã—ãŸæ‹¡æ•£æ–¹ç¨‹å¼ã«æ­£è¦ä¹±æ•°ã§å°‘ã—ãƒã‚¤ã‚ºã‚’ä¹—ã›ã¦ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã—ã¦ã¿ã‚‹ï¼š

![](https://storage.googleapis.com/zenn-user-upload/4265cc69affb-20240322.png)

ã‚«ãƒ«ãƒãƒ³ãƒ•ã‚£ãƒ«ã‚¿ã¨ã‚¹ãƒ ãƒ¼ã‚¶ãƒ¼ã«ã‚ˆã‚‹ãƒ•ã‚£ãƒƒãƒ†ãƒ³ã‚°ã®ç¢ºèªï¼š

![](https://storage.googleapis.com/zenn-user-upload/1422e6d90d57-20240322.png)

ã‚¹ãƒ ãƒ¼ã‚¸ãƒ³ã‚°ã®çµæœï¼š

![](https://storage.googleapis.com/zenn-user-upload/01f34720c7cf-20240322.png)


ä½¿ç”¨ã—ãŸã‚³ãƒ¼ãƒ‰ã¯ã™ã¹ã¦ã¾ã¨ã‚ã¦ä»¥ä¸‹ã«å…¬é–‹ã™ã‚‹ï¼š

@[gist](https://gist.github.com/abikoushi/76f49951e2e01666d6bc0fc594d10920)
