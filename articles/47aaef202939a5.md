---
title: "å¤šé …åˆ†å¸ƒã®æœ€å°¤æ¨å®šé‡ã‚’æ±‚ã‚ã‚‹ï¼ˆãƒ©ã‚°ãƒ©ãƒ³ã‚¸ãƒ¥ã®æœªå®šä¹—æ•°æ³•ã‚’ä½¿ã‚ãªã„ï¼‰"
emoji: "ğŸ²"
type: "tech"
topics:
  - "r"
  - "çµ±è¨ˆ"
  - "æœ€å°¤æ¨å®š"
  - "å¤šé …åˆ†å¸ƒ"
published: true
published_at: "2024-05-29 17:19"
---

## å‰ç½®ã

ã€Œå¤šé …åˆ†å¸ƒã€€æœ€å°¤æ¨å®šé‡ã€ãªã©ã§æ¤œç´¢ã™ã‚‹ã¨ãƒ©ã‚°ãƒ©ãƒ³ã‚¸ãƒ¥ã®æœªå®šä¹—æ•°æ³•ã‚’ä½¿ã£ã¦ã„ã‚‹è§£èª¬ãŒå¤šã„å°è±¡ã ã£ãŸ.

ãã‚Œã‚‰ã«å•é¡ŒãŒã‚ã‚‹ã‚ã‘ã§ã¯ã¾ã£ãŸããªã„ãŒè‰²ã€…ãªå›ç­”ä¾‹ãŒã‚ã‚‹ã»ã†ãŒ, ãªã„ã‚ˆã‚Šã¯ã„ã„ã¨æ€ã£ãŸã®ã§æ›¸ã„ãŸ.


## "N=1" ã®ã¨ã

$x = (x_1, \ldots, x_m)'$ ã‚’ã‚µã‚¤ã‚ºãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ $n$, ç¢ºç‡ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ $p = (p_1, \ldots, p_m)'$ ã®å¤šé …åˆ†å¸ƒã«å¾“ã†ç¢ºç‡å¤‰æ•°ã¨ã™ã‚‹. ã“ã®ã“ã¨ã‚’æ¬¡ã®ã‚ˆã†ã«ã‚‚æ›¸ã.

$$
x \sim \mathrm{Mult}(x | n, p).
$$

$p_j$ ã¯ç¢ºç‡ãªã®ã§0ä»¥ä¸Šã§ $\sum_j p_j  = 1$ ã§ã‚ã‚‹.

å¤šé …åˆ†å¸ƒã®ç¢ºç‡é–¢æ•°ã¯

$$
\mathrm{Mult}(x | n, p)= C_{n,x} \prod_{i=1}^m p_i^{x_i} 
$$

ã§ã‚ã‚‹. ã“ã“ã§ $C_{n,x}$ ã¯å¤šé …ä¿‚æ•°ã‚’è¡¨ã™ãŒ, ã“ã®ã‚ã¨å¯¾æ•°ã¨ã£ã¦å¾®åˆ†ã™ã‚‹ã¨æ¶ˆãˆã‚‹ï¼ˆ0ã«ãªã‚‹ï¼‰éƒ¨åˆ†ãªã®ã§çœç•¥ã—ãŸæ›¸ãæ–¹ã«ã—ã¦ã„ã‚‹.

$n = \sum_j x_j$ ã¯å›ºå®šã§æ—¢çŸ¥. æœªçŸ¥ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã® $p$ ã‚’æ¨å®šã—ãŸã„.

$p$ ã«ã¤ã„ã¦ã®å¯¾æ•°å°¤åº¦ã¯

$$
l(p)= \log C_{n,x} + \sum_{j=1}^m x_j \log p_j
$$

ã“ã‚Œã‚’åå¾®åˆ†ã—ã¦0ã¨ãªã‚‹ç‚¹ã‚’æ±‚ã‚ãŸã„.

$$
p_m = 1-\sum_{j=1}^{m-1} p_j
$$

ã«æ³¨æ„ã—ã¦, 

$$
\frac{\partial}{\partial p_j} l(p)=  x_i / p_j - x_m/p_m.
$$

å³è¾ºãŒ0ã«ãªã‚‹ $p_j$ ã¯

$$
x_jp_m - p_jx_m = 0
$$

ã‚’æº€ãŸã™ã®ã§, 

$$
p_j = x_jp_m/x_m \tag{1}
$$

ã‚’æº€ãŸã™.

ã‚ˆã£ã¦,

$$
\sum_{j=1}^m p_j = (p_m/x_m)\sum_{j=1}^m x_j.
$$

å·¦è¾ºã¯1ã§ãªã‘ã‚Œã°ã„ã‘ãªã„ã®ã§ $p_m$ ã®æœ€å°¤æ¨å®šé‡ $\hat{p}_m$ã¯

$$
\hat{p}_m = \frac{x_m}{\sum_{j=1}^m x_j}.
$$

å¼(1)ã§ $p_m = \hat{p}_m$ ã¨ã™ã‚‹ã¨, $p_j$ ã®æœ€å°¤æ¨å®šé‡ $\hat{p}_j$ ã¯

$$
\hat p_j = \frac{x_j}{\sum_{j=1}^m x_j}.
$$


## "N>1" ã®ã¨ã

ç‹¬ç«‹ã«åŒã˜ç¢ºç‡ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ $p$ ã‚’æŒã¤å¤šé …åˆ†å¸ƒã«å¾“ã†ç¢ºç‡å¤‰æ•° $\boldsymbol{x}_i$ ($i=1, \ldots, N$) ãŒã‚ã‚‹ã¨ã, ãã®åŒæ™‚åˆ†å¸ƒã®ç¢ºç‡é–¢æ•°ã¯

$$
\prod_{i=1}^N \mathrm{Mult}(\boldsymbol{x}_i | n_i, p)=\prod_{i=1}^N  C_{n_i,x_i} \prod_{j=1}^m p_j^{x_{ij}}
$$

ãªã®ã§ $p$ ã«ã¤ã„ã¦ã®å¯¾æ•°å°¤åº¦ã¯

$$
l(p)= \left(\sum_{i=1}^N \log C_{n_i,\boldsymbol{x}_i} \right) + \left(\sum_{j=1}^m \left\{\sum_{i=1}^N x_{ij} \right\} \log p_j \right).
$$

$\sum_{i=1}^N x_{ij}$ ã‚’æ–°ãŸãª $x_j$ ã¨è¦‹ã‚Œã°å¾Œã¯ã€Œ$N=1$ã®ã¨ãã€ã¨ä¸€ç·’ã§ã‚ã‚‹.


## Rã«ã‚ˆã‚‹å®Ÿè£…ä¾‹

```r
p <- c(0.1,0.2,0.3,0.4) #set p
set.seed(132)
X <- rmultinom(1, 100, p) #sample (N=1 n=100)
phat <- sweep(X, 1, colSums(X), FUN = "/") #equivalent to X/sum(X)
cat("true p: ", p, "\n")
cat("estimates: ", phat, "\n")
```

```r
> cat("true p: ", p, "\n")
true p:  0.1 0.2 0.3 0.4 
> cat("estimates: ", phat, "\n")
estimates:  0.11 0.26 0.25 0.38 
```
