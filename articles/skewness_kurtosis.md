---
title: "Julia ã§å­¦ã¶æ­ªåº¦ãƒ»å°–åº¦"
emoji: "ğŸ‘»"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [Julia, ç¢ºç‡åˆ†å¸ƒ]
published: true
---

## ã‚ã‚‰ã¾ã—

ãƒ¢ãƒ¼ãƒ¡ãƒ³ãƒˆæ¯é–¢æ•°ã®å¯¾æ•°ã‚’å–ã£ãŸã‚‚ã®ã‚’ã‚­ãƒ¥ãƒ ãƒ©ãƒ³ãƒˆæ¯é–¢æ•°ã¨ã„ã†ï¼
ã‚­ãƒ¥ãƒ ãƒ©ãƒ³ãƒˆæ¯é–¢æ•°ã®ãƒ†ã‚¤ãƒ©ãƒ¼å±•é–‹ã‚’ç”¨ã„ã‚‹ã¨ï¼Œä¸­å¿ƒæ¥µé™å®šç†ã«ã‚ˆã‚‹æ­£è¦åˆ†å¸ƒã¸ã®åæŸã®é€Ÿã•ãŒæ­ªåº¦ãƒ»å°–åº¦ã§ã»ã¼æ±ºã¾ã‚‹ã“ã¨ãŒã‚ã‹ã‚‹ï¼

ã¾ãŸï¼ŒJulia ã® [Distibutions.jl](https://juliastats.org/Distributions.jl/stable/) ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã§ã¯ç¢ºç‡åˆ†å¸ƒã®æ­ªåº¦ãƒ»å°–åº¦ã®è¨ˆç®—ã‚‚å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ã®ã§ï¼Œã“ã‚Œã‚’ä½¿ã£ã¦æ•°å€¤çš„ã«ã‚‚ãŸã—ã‹ã‚ã¦ã¿ã‚‹ï¼

## æ‰‹è¨ˆç®—ã—ã¦ã¿ã‚‹

ã“ã®ãƒ‘ãƒ¼ãƒˆã¯ä¸»ã« [ç«¹å†…å•“ã€æ•°ç†çµ±è¨ˆå­¦: ãƒ‡ãƒ¼ã‚¿è§£æã®æ–¹æ³•ã€ï¼ˆæ±æ´‹çµŒæ¸ˆæ–°å ±ç¤¾ï¼‰](https://books.google.co.jp/books/about/æ•°ç†çµ±è¨ˆå­¦.html?id=fSo8DwAAQBAJ&redir_esc=y) ã‚’å‚è€ƒã«ã—ã¦ã„ã‚‹ï¼ˆãŸã ã—ã¾ã£ãŸãåŒã˜ã§ã¯ãªã„ï¼‰ï¼

### æº–å‚™

ã¾ãšç”¨èªã‚’ç¢ºèªã™ã‚‹ï¼

ç¢ºç‡å¤‰æ•° $X$ ã® **ãƒ¢ãƒ¼ãƒ¡ãƒ³ãƒˆæ¯é–¢æ•°** $\phi_X(t)$ ã‚’

$$
\phi_X(t) = E[e^{tX}]
$$

ã¨å®šç¾©ã™ã‚‹ã¨ï¼Œãƒ†ã‚¤ãƒ©ãƒ¼å±•é–‹

$$
\phi_X(t) = \phi_X  (0) + \phi_X' (0) t + \frac{\phi_X '' (0)}{2} t^2 + \frac{\phi_X^{(3)} (0)}{3!} t^3 + \frac{\phi_X^{(4)} (0)}{4!}t^4 + \cdots
$$

ã® $j$ æ¬¡ã®é …ã®ä¿‚æ•°  $\phi_X^{(j)} (0)$ ãŒ $j$ æ¬¡ã®ãƒ¢ãƒ¼ãƒ¡ãƒ³ãƒˆ $\mu_j = E[X^j]$ ã«ãªã‚‹ï¼ãŸã ã— $\phi_X  (0)  =  1$ ã§ã‚ã‚‹ï¼

ãƒ¢ãƒ¼ãƒ¡ãƒ³ãƒˆæ¯é–¢æ•°ã®å¯¾æ•°ã‚’å–ã£ãŸ $\psi_X (t) = \log \phi_X(t)$ ã‚’ **ã‚­ãƒ¥ãƒ ãƒ©ãƒ³ãƒˆæ¯é–¢æ•°** ã¨å‘¼ã¶ï¼

ã‚­ãƒ¥ãƒ ãƒ©ãƒ³ãƒˆæ¯é–¢æ•°ã®ãƒ†ã‚¤ãƒ©ãƒ¼å±•é–‹

$$
\psi_X(t) = \kappa_0 + \kappa_1 t + \frac{\kappa_2 }{2} t^2 + \frac{\kappa_3}{3!} t^3 + \frac{\kappa_4}{4!}t^4 + \cdots
$$

ã® $j$ æ¬¡ã®é …ã®ä¿‚æ•°  $\kappa_j$ ã‚’ $j$ æ¬¡ã® **ã‚­ãƒ¥ãƒ ãƒ©ãƒ³ãƒˆ** ã¨å‘¼ã¶ï¼

ã‚­ãƒ¥ãƒ ãƒ©ãƒ³ãƒˆã¨ãƒ¢ãƒ¼ãƒ¡ãƒ³ãƒˆã®é–“ã«ã¯æ¬¡ã®ã‚ˆã†ãªé–¢ä¿‚ãŒã‚ã‚‹ï¼

$$
\begin{aligned}
\kappa_0 &= \log \phi(0) = \log 1 = 0,\\
\kappa_1 &= \left. \frac{d}{dt} \log \phi(t) \right| _{t=0} = \phi'(0)/\phi(0) = \mu_1\\
\kappa_2 &= \frac{ \phi''(0)\phi'(0) - \{\phi'(0)\}^2}{\{\phi(0)\}^2} = \mu_2-\mu_1^2\\
&\vdots
\end{aligned}
$$

$\mu_2-\mu_1^2$ ã¯ $E[X^2] - \{E[X]\}^2$ ãªã®ã§ $X$ ã®åˆ†å¸ƒã®åˆ†æ•£ã§ã‚ã‚‹ï¼$\sigma^2 = \mu_2-\mu_1^2$ ã¨æ›¸ãã“ã¨ã«ã™ã‚‹ï¼


### ä¸­å¿ƒæ¥µé™å®šç†ã¨æ­ªåº¦ãƒ»å°–åº¦

ã“ã“ã§ã¯ $j$ æ¬¡ã®ãƒ¢ãƒ¼ãƒ¡ãƒ³ãƒˆãŒã™ã¹ã¦å­˜åœ¨ã™ã‚‹ï¼ˆç©åˆ†ãŒåæŸã™ã‚‹ï¼‰åˆ†å¸ƒã®å ´åˆã®ã¿ã‚’è€ƒãˆã‚‹ï¼

ç‹¬ç«‹ã«åŒã˜åˆ†å¸ƒã«å¾“ã†ç¢ºç‡å¤‰æ•° $X_i$ ($i=1,\ldots,n$) ã®æ¨™æœ¬å¹³å‡ $\displaystyle \bar{X} = \frac{1}{n} \sum_{i=1}^n X_i$ ãŒæ­£è¦åˆ†å¸ƒã«åæŸã™ã‚‹ã“ã¨ã‚’ç¤ºã—ãŸã„ï¼

ã¨ã“ã‚ã§ï¼Œæ¨™æº–æ­£è¦åˆ†å¸ƒ $\mathcal{N}(0, 1)$ ã«å¾“ã†ç¢ºç‡å¤‰æ•° $Z$ ã‚’ $Y=aZ+b$ ï¼ˆ$a,b$ã¯å®šæ•°ï¼‰ã¨å¤‰æ•°å¤‰æ›ã—ãŸ $Y$ ã¯å¹³å‡ $\mu$ï¼Œåˆ†æ•£ $a^2$ ã®æ­£è¦åˆ†å¸ƒ $\mathcal{N}(b, a^2)$ ã«å¾“ã†ï¼

ãã®ãŸã‚ï¼Œ$\bar X$ ãŒæ­£è¦åˆ†å¸ƒã«å¾“ã†ã“ã¨ã‚’ç¤ºã™ãŸã‚ã«, æ¨™æœ¬å¹³å‡ã‚’ $X_i$ ã®åˆ†å¸ƒã®å¹³å‡ $\mu$ ã¨æ¨™æº–åå·® $\sigma$ ã§å¤‰æ•°å¤‰æ› $Y= \sqrt{n}(\bar{X} - \mu)/\sigma$ ãŒæ¨™æº–æ­£è¦åˆ†å¸ƒã«å¾“ã†ã“ã¨ã‚’ç¤ºã™ï¼

$Y$ ã®ãƒ¢ãƒ¼ãƒ¡ãƒ³ãƒˆæ¯é–¢æ•°ã¯ï¼Œ

$$
\begin{aligned}
\phi_Y(t) &= E[e^{t Y}] = E[\exp( \sqrt{n}(\bar{X} - \mu)/\sigma )]\\
&= E[\exp( \sqrt{n} \bar{X}/\sigma)]\exp( -\sqrt{n}\mu/\sigma) \\
&= \left(E\left[\exp \left( \frac{X_1}{\sigma\sqrt{n}}\right)\right] \right)^n\exp( -\sqrt{n}\mu/\sigma ).
\end{aligned}
$$

2è¡Œç›®ã‹ã‚‰3è¡Œç›®ã®å¤‰å½¢ã§ç‹¬ç«‹åŒåˆ†å¸ƒã®ä»®å®šã‚’ä½¿ã£ãŸï¼

$Y$ ã®ã‚­ãƒ¥ãƒ ãƒ©ãƒ³ãƒˆæ¯é–¢æ•°ã‚’ãƒ†ã‚¤ãƒ©ãƒ¼å±•é–‹ã™ã‚‹ã¨ï¼Œã€Œæº–å‚™ã€ã§è¿°ã¹ãŸã‚­ãƒ¥ãƒ ãƒ©ãƒ³ãƒˆã¨ãƒ¢ãƒ¼ãƒ¡ãƒ³ãƒˆã®é–¢ä¿‚ã‹ã‚‰ï¼Œ

$$
\begin{aligned}
\psi_Y(t) &= \log \phi_Y(t) \\
&= n\left\{\kappa_0 + \frac{\kappa_1}{\sqrt{n}\sigma} t + \frac{\kappa_2 /(\sqrt{n}\sigma)^2}{2} t^2 + \frac{\kappa_3/(\sqrt{n}\sigma)^3}{3!} t^3 + \frac{\kappa_4/(n^2 \sigma^4)}{4!}t^4 + \cdots \right\} -\sqrt{n}\mu/\sigma \\
&= \frac{\kappa_2 /\sigma^2}{2} t^2 + \frac{\kappa_3/\sigma^3}{\sqrt{n} \, 3!} t^3 + \frac{\kappa_4/\sigma^4}{n \, 4!}t^4 + \cdots
\end{aligned}
$$

ã¨æ•´ç†ã§ãã‚‹ï¼å³è¾ºã®ç¬¬ä¸€é …ã¯æ¨™æº–æ­£è¦åˆ†å¸ƒã®ã‚­ãƒ¥ãƒ ãƒ©ãƒ³ãƒˆæ¯é–¢æ•°ã§ã‚ã‚‹ï¼
ã‚­ãƒ¥ãƒ ãƒ©ãƒ³ãƒˆæ¯é–¢æ•°ã¯ä¸€æ„ã§ã‚ã‚Šï¼Œä»–ã®é …ã¯ $O(1/\sqrt{n})$ ã§ 0ã«è¿‘ã¥ãã®ã§ $n$ ãŒå¤§ãã„ã¨ã $Y$ ãŒæ¨™æº–æ­£è¦åˆ†å¸ƒã«è¿‘ã¥ãã“ã¨ãŒã‚ã‹ã£ãŸï¼

$1/\sqrt{n}$ ã¨åŒã˜ãã‚‰ã„ã®é€Ÿã•ã§ 0 ã«è¿‘ã¥ã3æ¬¡ã®é …ã®ä¿‚æ•° $\kappa_3/\sigma^3$ ã‚’ **æ­ªåº¦**ï¼ˆskewnessï¼‰ï¼Œ$1/n$ ã¨åŒã˜ãã‚‰ã„ã®é€Ÿã•ã§ 0 ã«è¿‘ã¥ã4æ¬¡ã®é …ã®ä¿‚æ•° $\kappa_4/\sigma^4$ ã‚’ **å°–åº¦**ï¼ˆkurtosisï¼‰ã¨å‘¼ã¶ï¼

æ­ªåº¦ãŒ 0 ã®ã¨ãã¯æ­£è¦åˆ†å¸ƒã¸ã®åæŸã®é€Ÿã•ãŒ $O(1/n)$ ã«ãªã£ã¦ï¼Œãã®é€Ÿã•ãŒå°–åº¦ã§ã»ã¼æ±ºã¾ã‚‹ã¨ã„ã†ã“ã¨ã§ã‚ã‚‹ï¼

ä¸­å¿ƒæ¥µé™å®šç†ã¯æ•°ç†çµ±è¨ˆå­¦ã®æ•™ç§‘æ›¸ã«ã¯ã ã„ãŸã„å‡ºã¦ã„ã‚‹ã¨æ€ã†ãŒï¼Œè¨¼æ˜ã¯ãƒ¢ãƒ¼ãƒ¡ãƒ³ãƒˆæ¯é–¢æ•°ã‚’ä½¿ã†ã‚‚ã®ï¼ˆä¾‹ãˆã°ï¼Œé‡ç”°ä¸€å¤«ãƒ»å®®å²¡æ‚¦è‰¯ã€å…¥é–€æ¼”ç¿’ã€€æ•°ç†çµ±è¨ˆã€å…±ç«‹å‡ºç‰ˆï¼‰ã‚„ï¼Œç‰¹æ€§é–¢æ•°ã‚’ä½¿ã†ã‚‚ã®ï¼ˆä¾‹ãˆã°ï¼Œä¹…ä¿å·é”ä¹Ÿã€ç¾ä»£æ•°ç†çµ±è¨ˆå­¦ã®åŸºç¤ã€å…±ç«‹å‡ºç‰ˆï¼‰ãŒå¤šã„å°è±¡ãŒã‚ã‚‹ï¼

ã“ã“ã§ç´¹ä»‹ã—ãŸ [ç«¹å†…å•“ã€æ•°ç†çµ±è¨ˆå­¦: ãƒ‡ãƒ¼ã‚¿è§£æã®æ–¹æ³•ã€ï¼ˆæ±æ´‹çµŒæ¸ˆæ–°å ±ç¤¾ï¼‰](https://books.google.co.jp/books/about/æ•°ç†çµ±è¨ˆå­¦.html?id=fSo8DwAAQBAJ&redir_esc=y) ã®ã‚ˆã†ã«ã‚­ãƒ¥ãƒ ãƒ©ãƒ³ãƒˆæ¯é–¢æ•°ã‚’ä½¿ã†æ–¹é‡ã ã¨ï¼Œè¨ˆç®—ã®é›£ã—ã•ã¯ã»ã¼åŒã˜ã®ã¾ã¾ $n \to \infty$ ã§ã®åæŸå…ˆã ã‘ã§ãªãåæŸã®é€Ÿã•ã‚‚çŸ¥ã‚Œã‚‹ã¨ã„ã†è‰¯ã•ãŒã‚ã‚‹ï¼ã“ã®ãƒ¡ãƒªãƒƒãƒˆã¯ã‘ã£ã“ã†å¤§ãã„ã¨æ€ã†ï¼

ãŸã ã—ç‰¹æ€§é–¢æ•°ã‚’ä½¿ã†ã¨ãƒ¢ãƒ¼ãƒ¡ãƒ³ãƒˆæ¯é–¢æ•°ãŒå­˜åœ¨ã—ãªã„å ´åˆã«ã¤ã„ã¦ã‚‚ç¤ºã›ã‚‹ã¨ã„ã†ãƒ¡ãƒªãƒƒãƒˆãŒã‚ã‚‹ï¼

## æ•°å€¤è¨ˆç®—ã—ã¦ã¿ã‚‹

ã¾ãŸï¼ŒJulia ã® [Distibutions.jl](https://juliastats.org/Distributions.jl/stable/) ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã§ã¯ç¢ºç‡åˆ†å¸ƒã®æ­ªåº¦ã¯ `skewness` ã¨ã„ã†é–¢æ•°ã§ï¼Œå°–åº¦ã¯ `kurtosis` ã¨ã„ã†é–¢æ•°ã§å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ï¼

ã“ã‚“ãªãµã†ã«ã™ã‚‹ã¨æ­£è¦åˆ†å¸ƒã®æ­ªåº¦ãƒ»å°–åº¦ãŒå‡ºã‚‹ï¼š

```julia
using Distributions
using Random
using Statistics
using Plots

N0 = Normal(0,1)
skewness(N0) #0
kurtosis(N0) #0
```

æ­ªåº¦ãŒ 0 ã®åˆ†å¸ƒã«ã¯ä¾‹ãˆã°ä¸€æ§˜åˆ†å¸ƒã‚„ãƒ­ã‚¸ã‚¹ãƒ†ã‚£ãƒƒã‚¯åˆ†å¸ƒãŒã‚ã‚‹ï¼ã“ã‚“ãªå½¢ã‚’ã—ã¦ã„ã‚‹ï¼

```julia
U1 = Uniform(-1,1)
skewness(U1) #0.0
kurtosis(U1) #-1.2

L1 = Logistic(0,1)
skewness(L1) #0.0
kurtosis(L1) #1.2

p = plot(x -> pdf(N0,x), -4, 4, tick_direction=:out, label="Normal", linestyle=:solid)
plot!(p, x -> pdf(U1,x), label="Uniform", linestyle=:dash)
plot!(p, x -> pdf(L1,x), label="Logistic", linestyle=:dot)
```

![](/images/skewness_kurtosis/density1.png)

æ¬¡ã®ã‚ˆã†ã«æ¨™æœ¬åˆ†å¸ƒ $Y= \sqrt{n}(\bar{X} - \mu)/\sigma$ ã‚’ç¹°ã‚Šè¿”ã—æ±‚ã‚ã‚‹é–¢æ•°ã‚’å®£è¨€ã™ã‚‹ï¼

```julia
function simCLT(dist, size, iter)
    out = zeros(iter)
    rng = Random.default_rng()
    for i in 1:iter
        X = rand(rng, dist, size)
        out[i] = (mean(X) - mean(dist)) * sqrt(size)/std(dist)
    end
     return out
end
```

ä¸€æ§˜åˆ†å¸ƒã®ã¨ãã® $Y$ ã®ãƒ’ã‚¹ãƒˆã‚°ãƒ©ãƒ ã‚’è¦‹ã‚‹ã¨ $n=10$ ã§ã‚‚çµæ§‹æ­£è¦åˆ†å¸ƒã«è¿‘ã„ï¼é’ã„ç·šã§æ¨™æº–æ­£è¦åˆ†å¸ƒã®å¯†åº¦é–¢æ•°ã‚’é‡ã­ã¦ã‚ã‚‹ï¼

```julia
col1 = palette(:default)[1:3]
outU1 = simCLT(U1, 10, 10000)
h = histogram(outU1, legend=false, normalize=:pdf, color="lightgray", tick_direction=:out)
plot!(h, x->pdf(Normal(),x), linewidth=2, color=col1[1])
```

![](/images/skewness_kurtosis/hist1.png)


ãƒ­ã‚¸ã‚¹ãƒ†ã‚£ãƒƒã‚¯åˆ†å¸ƒã®ã¨ãã‚‚åŒæ§˜ã§ã‚ã‚‹ï¼

```r
outL1 = simCLT(L1, 10, 10000)
h = histogram(outL1, legend=false, normalize=:pdf, color="lightgray", tick_direction=:out)
plot!(h, x->pdf(Normal(),x),  linewidth=2, color=col1[1])
```

![](/images/skewness_kurtosis/hist2.png)

ä¸€æ–¹ï¼Œæ­ªåº¦ãŒ 0 ã‚ˆã‚Šå¤§ãã„åˆ†å¸ƒã®ä¸€ä¾‹ã¨ã—ã¦æŒ‡æ•°åˆ†å¸ƒã‚’ã¿ã‚‹ï¼

```julia
E1 = Exponential(1)

skewness(E1) #2.0
kurtosis(E1) #6.0

p = plot(x -> pdf(N0,x), -4, 4, tick_direction=:out, label="Normal", linestyle=:solid)
plot!(x->pdf(E1,x), 0,4, label="Exponential", linestyle=:dash,tick_direction=:out)
```

![](/images/skewness_kurtosis/density2.png)


æŒ‡æ•°åˆ†å¸ƒã®ã¨ãã® $Y$ ã®ãƒ’ã‚¹ãƒˆã‚°ãƒ©ãƒ ã‚’è¦‹ã‚‹ã¨ $n=10$ ã§ã¯æ­£è¦åˆ†å¸ƒã‹ã‚‰çµæ§‹é›¢ã‚Œã¦ã„ã‚‹ï¼é’ã„ç·šã§æ¨™æº–æ­£è¦åˆ†å¸ƒã®å¯†åº¦é–¢æ•°ã‚’é‡ã­ã¦ã‚ã‚‹ï¼

```julia
outE11 = simCLT(E1,  10, 10000)
h = histogram(outE11, legend=false, normalize=:pdf, color="lightgray")
plot!(h, x->pdf(Normal(),x), color=col1[1])
```

![](/images/skewness_kurtosis/hist3.png)

$n=100 ~(=10^2)$ ãã‚‰ã„ã¾ã§å¤§ããã™ã‚‹ã¨ã¡ã‚‡ã£ã¨è¿‘ã¥ã„ã¦ãã‚‹ï¼

```julia
outE12 = simCLT(E1, 100, 10000)
h = histogram(outE12, legend=false, normalize=:pdf, color="lightgray")
plot!(h, x->pdf(Normal(),x), color=col1[1])
```

![](/images/skewness_kurtosis/hist4.png)

ï¼ˆãŠã—ã¾ã„ï¼‰